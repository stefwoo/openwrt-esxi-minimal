#!/bin/sh

# ========================================
# OpenWrt 旁路由网络配置
# IP: 192.168.1.9
# Gateway: 192.168.1.8 (主路由)
# ========================================

# 设置LAN IP
uci set network.lan.ipaddr='192.168.1.9'
uci set network.lan.proto='static'
uci set network.lan.netmask='255.255.255.0'
uci set network.lan.gateway='192.168.1.8'
uci set network.lan.dns='192.168.1.8'

# 禁用IPv6
uci set network.lan.ipv6='0'
uci delete network.lan.ip6assign 2>/dev/null || true

# 禁用DHCP服务器（使用主路由的DHCP）
uci set dhcp.lan.ignore='1'
uci set dhcp.lan.dhcpv6='disabled'
uci set dhcp.lan.ra='disabled'

# 配置防火墙为透传模式
uci set firewall.@defaults[0].input='ACCEPT'
uci set firewall.@defaults[0].output='ACCEPT'
uci set firewall.@defaults[0].forward='ACCEPT'
uci set firewall.@defaults[0].synflood_protect='0'

# 启用IP转发
uci set firewall.@defaults[0].flow_offloading='0'

# 保存更改
uci commit network
uci commit dhcp
uci commit firewall

# 启用IP转发
echo 'net.ipv4.ip_forward=1' >> /etc/sysctl.conf
sysctl -p

exit 0
